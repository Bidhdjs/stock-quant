# 项目功能说明（现状整理）

**更新时间**：2026-01-31  
**说明**：本文件基于当前代码与历史文档整理，描述项目现有结构与可用功能。

## 1. 项目结构概览

```
stock-quant/
├── core/
│   ├── stock/                  # 数据源与数据标准化
│   ├── quant/                  # 回测引擎
│   ├── strategy/               # 策略与指标
│   ├── analysis/               # 分析与指标扩展
│   ├── visualization/          # 可视化（Plotly）
│   ├── signal/                 # 信号处理
│   ├── task/                   # 定时任务（默认不启用）
├── frontend/                   # Flask Web 前端（默认不作为入口）
├── data/                       # 数据存储
├── x/                          # 已迁移/实验代码来源
├── test/                       # pytest (mock_only)
└── settings.py                 # 全局配置
```

## 2. 核心入口与使用方式

### 2.1 CLI（主入口）
- 数据抓取：`python -m core.cli data fetch ...`
  - 示例：`python -m core.cli data fetch --market US --code AAPL --start 2026-01-01 --end 2026-01-30 --preferred yfinance,akshare`
- 回测：`python -m core.cli backtest ...`
  - 示例：`python -m core.cli backtest --csv data/stock/akshare/US.AAPL_AAPL_20211126_20251124.csv --strategy EnhancedVolumeStrategy --cash 5000000`
- 策略列表：`python -m core.cli strategy list`
  - 示例：`python -m core.cli strategy list`
- VCP 策略回测：`python -m core.cli backtest --csv ... --strategy VCPStrategy`
  - 示例：`python -m core.cli backtest --csv data/stock/akshare/US.AAPL_AAPL_20211126_20251124.csv --strategy VCPStrategy`
- 交易策略分析（统一入口）：`python -m core.cli strategy analyze --input ...`（输出 CSV + HTML）
  - 示例：`python -m core.cli strategy analyze --input x/option_trades_all.csv`

### 2.2 前端与定时任务
- 前端入口：`frontend/frontend_app.py`
- 定时任务：`core/task/task_timer.py` / `core/task/task_timer_script.py`
- 默认**不作为入口**；通过环境变量控制是否启用。

## 3. 数据源与标准化

- 数据源管理：`core/stock/*`
- 数据标准化与校验：`core/stock/manager_common.py`
- 数据源回退与优先级：`core/stock/data_source_router.py`
- 缺失成交量统一填 0 并记录提示日志
- CSV 标准字段：
  `date, open, high, low, close, volume, amount, stock_code, stock_name, market`

## 4. 回测与策略

- 回测引擎：`core/quant/quant_manage.py`
- 策略体系：`core/strategy/trading/`（继承 `StrategyBase`）
- 信号指标：`core/strategy/indicator/`（继承 `bt.Indicator`，只做信号规则判断）
- 指标计算：`core/analysis/indicators/`（统一计算指标数值，供信号层消费）

## 5. 分析与扩展模块

- 绩效/风险指标：`core/analysis/performance_metrics.py`
- 组合分析：`core/analysis/portfolio.py`
- 期权定价：`core/analysis/options_pricing.py`
- 预测指标/模型：`core/analysis/forecast_metrics.py`, `forecast_models.py`
- 技术指标扩展：`core/analysis/technical_indicators_ext.py`
- 统一指标计算：`core/analysis/indicators/`
- K 线形态检测：`core/analysis/candlestick_patterns.py`

## 6. VCP 相关能力

- VCP 信号工具：`core/analysis/migrations/vcp_tools.py`
- VCP 筛选器：`core/analysis/migrations/vcp_screener.py`
- VCP Plotly 报表：`core/analysis/migrations/vcp_plotly.py`
- youtuber 相关模块整理：`core/analysis/migrations/vcp_from_youtuber/`

## 7. 迁移整合成果（简述）

- StockQuant 迁移：实时行情（Sina/网易）、Tushare 基础数据、TA‑Lib 指标封装
- Stock_Analysis_For_Quant 迁移：绩效/风险指标、组合分析、期权、预测、K线形态等

## 8. 测试

- pytest 统一测试（mock_only）
- 示例命令：`python -m pytest -m mock_only`
