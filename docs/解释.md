æ­£åœ¨æ”¶é›†å·¥ä½œåŒºä¿¡æ¯# é¡¹ç›®åˆ†ææŠ¥å‘Š

æ ¹æ®æˆ‘å¯¹æ•´ä¸ªå·¥ä½œåŒºçš„åˆ†æï¼Œæˆ‘å·²ç»å…¨é¢ç†è§£äº†æ‚¨çš„ **stock-quant** é¡¹ç›®æ¶æ„ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š

## 1. é¡¹ç›®æ ¸å¿ƒæ¶æ„

```
stock-quant/
â”œâ”€â”€ core/                    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ quant/              # å›æµ‹å¼•æ“ (quant_manage.py)
â”‚   â”œâ”€â”€ strategy/           # ç­–ç•¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ trading/        # äº¤æ˜“ç­–ç•¥ (ç»§æ‰¿ StrategyBase)
â”‚   â”‚   â””â”€â”€ indicator/      # æŠ€æœ¯æŒ‡æ ‡
â”‚   â”œâ”€â”€ stock/              # æ•°æ®æºç®¡ç†
â”‚   â”œâ”€â”€ signal/             # ä¿¡å·å¤„ç†
â”‚   â””â”€â”€ task/               # å®šæ—¶ä»»åŠ¡
â”œâ”€â”€ frontend/               # Flask Web ç•Œé¢
â”œâ”€â”€ x/                      # å®éªŒæ€§ä»£ç  (å¾…æ•´åˆ)
â”‚   â””â”€â”€ vcp_from_youtuber/  # VCPç­–ç•¥åŸå‹
â”œâ”€â”€ data/                   # æ•°æ®å­˜å‚¨
â””â”€â”€ settings.py             # å…¨å±€é…ç½®
```

## 2. ç°æœ‰æ•°æ®æºæ”¯æŒ

| æ•°æ®æº | æ¨¡å— | çŠ¶æ€ |
|--------|------|------|
| AKShare | `manager_akshare` | âœ… å·²é›†æˆ |
| BaoStock | `manager_baostock` | âœ… å·²é›†æˆ |
| Futu | `manager_futu` | âœ… å·²é›†æˆ |
| yfinance | x æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ | âš ï¸ æœªæ•´åˆ |
| CCXT (åŠ å¯†è´§å¸) | vcpå›æµ‹btc.py | âš ï¸ æœªæ•´åˆ |

## 3. vcp_from_youtuber æ–‡ä»¶å¤¹åˆ†æ

è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«å¤§é‡**æœªæ•´åˆä½†æœ‰ä»·å€¼çš„ä»£ç **ï¼š

| æ–‡ä»¶ | æ ¸å¿ƒåŠŸèƒ½ | æ•´åˆä¼˜å…ˆçº§ |
|------|----------|------------|
| å¸¦csvæ•°æ®ä¿å­˜çš„è¿‡æ»¤.py | `StrategyScreener` + Minerviniè¶‹åŠ¿æ¨¡æ¿ | ğŸ”´ é«˜ |
| SuperTrendè¶‹åŠ¿é…åˆè¿‡æ»¤.py | SuperTrendæŒ‡æ ‡ + VCPæ£€æµ‹ | ğŸ”´ é«˜ |
| VCPæˆäº¤é‡åˆ†æç­–ç•¥v2.py | æˆäº¤é‡æ¯ç«­æ£€æµ‹ç®—æ³• | ğŸ”´ é«˜ |
| å®½åº¦é‡åŒ–.py | å¸‚åœºå®½åº¦åˆ†æ (ADL, McClellan) | ğŸŸ¡ ä¸­ |
| å›æµ‹.py | å‡å€¼å›å½’ç­–ç•¥å›æµ‹æ¡†æ¶ | ğŸŸ¡ ä¸­ |
| deep_learn_ç©å…·.py | LSTMé¢„æµ‹ç­–ç•¥ | ğŸŸ¢ ä½ |

## 4. äºŒæ¬¡å¼€å‘å»ºè®®è·¯çº¿å›¾

### é˜¶æ®µä¸€ï¼šæ•°æ®æºæ•´åˆ

```python
"""
æ•´åˆ yfinance æ•°æ®æºï¼Œå‚è€ƒ x/vcp_from_youtuber/ ä¸­çš„å®ç°
"""
import yfinance as yf
import pandas as pd
from core.stock.manager_common import standardize_stock_data

class YFinanceManager:
    """yfinance æ•°æ®ç®¡ç†å™¨ - æ”¯æŒç¾è‚¡ã€æ¸¯è‚¡ã€å°è‚¡"""
    
    def get_stock_data(self, ticker: str, start_date: str, end_date: str) -> pd.DataFrame:
        """
        è·å–è‚¡ç¥¨æ•°æ®å¹¶æ ‡å‡†åŒ–
        
        æ•°å­¦åŸç†ï¼šä½¿ç”¨ auto_adjust=True è‡ªåŠ¨å¤„ç†å¤æƒï¼Œ
        é¿å…åˆ†çº¢å’Œæ‹†è‚¡å¯¹ä»·æ ¼åºåˆ—çš„å½±å“
        """
        df = yf.download(ticker, start=start_date, end=end_date, 
                        auto_adjust=True, progress=False)
        
        # å¤„ç† MultiIndex åˆ—å (yfinance æ–°ç‰ˆæœ¬ç‰¹æ€§)
        if isinstance(df.columns, pd.MultiIndex):
            df.columns = df.columns.get_level_values(0)
        
        return standardize_stock_data(df)
```

### é˜¶æ®µäºŒï¼šVCPç­–ç•¥æ•´åˆ

```python
"""
VCP (Volatility Contraction Pattern) ç­–ç•¥
åŸºäº Mark Minervini çš„è¶‹åŠ¿æ¨¡æ¿
"""
import backtrader as bt
import numpy as np
from core.strategy.strategy_base import StrategyBase

class VCPStrategy(StrategyBase):
    """
    VCP æ³¢åŠ¨æ”¶ç¼©æ¨¡å¼ç­–ç•¥
    
    æ•°å­¦åŸç†ï¼š
    1. è¶‹åŠ¿æ¨¡æ¿ï¼šä»·æ ¼éœ€åœ¨ SMA50 > SMA150 > SMA200 çš„ç»“æ„ä¸­
    2. æ³¢åŠ¨æ”¶ç¼©ï¼šATR æˆ–æ ‡å‡†å·®å‘ˆé˜¶æ¢¯å¼ä¸‹é™
    3. æˆäº¤é‡æ¯ç«­ï¼šè¿‘æœŸæˆäº¤é‡ < 50æ—¥å‡é‡
    """
    
    params = (
        ('sma_short', 50),
        ('sma_long', 200),
        ('atr_period', 14),
        ('volume_ma', 50),
    )
    
    def __init__(self):
        super().__init__()
        # å‘é‡åŒ–è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        self.sma50 = bt.indicators.SMA(self.data.close, period=self.p.sma_short)
        self.sma200 = bt.indicators.SMA(self.data.close, period=self.p.sma_long)
        self.atr = bt.indicators.ATR(self.data, period=self.p.atr_period)
        self.vol_ma = bt.indicators.SMA(self.data.volume, period=self.p.volume_ma)
    
    def check_trend_template(self) -> bool:
        """æ£€æŸ¥ Minervini è¶‹åŠ¿æ¨¡æ¿ 8 æ¡è§„åˆ™"""
        close = self.data.close[0]
        # è§„åˆ™1: ä»·æ ¼åœ¨200æ—¥å‡çº¿ä¹‹ä¸Š
        # è§„åˆ™2: 200æ—¥å‡çº¿å‘ä¸Š
        # ...å®Œæ•´å®ç°å‚è€ƒ x/vcp_from_youtuber/å¸¦csvæ•°æ®ä¿å­˜çš„è¿‡æ»¤.py
        return close > self.sma200[0] and self.sma50[0] > self.sma200[0]
```

### é˜¶æ®µä¸‰ï¼šç»Ÿä¸€æ•°æ®æ¥å£

```python
"""
æ•°æ®æºå·¥å‚æ¨¡å¼ - ç»Ÿä¸€æ¥å£
"""
from enum import Enum
from typing import Protocol
import pandas as pd

class DataSource(Enum):
    AKSHARE = "akshare"
    BAOSTOCK = "baostock"
    FUTU = "futu"
    YFINANCE = "yfinance"
    CCXT = "ccxt"

class StockDataProvider(Protocol):
    """æ•°æ®æä¾›è€…åè®®"""
    def get_stock_data(self, code: str, start: str, end: str) -> pd.DataFrame: ...

class DataFactory:
    """
    æ•°æ®æºå·¥å‚
    æ ¹æ® settings.py é…ç½®è‡ªåŠ¨é€‰æ‹©æ•°æ®æº
    """
    _providers: dict[DataSource, StockDataProvider] = {}
    
    @classmethod
    def register(cls, source: DataSource, provider: StockDataProvider):
        cls._providers[source] = provider
    
    @classmethod
    def get_data(cls, source: DataSource, **kwargs) -> pd.DataFrame:
        provider = cls._providers.get(source)
        if not provider:
            raise ValueError(f"æœªæ³¨å†Œçš„æ•°æ®æº: {source}")
        return provider.get_stock_data(**kwargs)
```

## 5. å…³äº @workspace å‘½ä»¤æµ‹è¯•

âœ… **ç¡®è®¤**ï¼šæˆ‘å·²æˆåŠŸè¯»å–å¹¶åˆ†æäº†æ‚¨å·¥ä½œåŒºçš„å…¨éƒ¨ä»£ç ç»“æ„ï¼ŒåŒ…æ‹¬ï¼š

- æ ¸å¿ƒæ¨¡å—ï¼šquant_manage.py, strategy_manager.py
- å‰ç«¯è·¯ç”±ï¼šfrontend_app.py çš„å®Œæ•´ API ç«¯ç‚¹
- å®éªŒä»£ç ï¼švcp_from_youtuber ä¸‹æ‰€æœ‰ 11 ä¸ª Python æ–‡ä»¶
- é…ç½®æ–‡ä»¶ï¼šsettings.py çš„äº¤æ˜“å‚æ•°

## 6. ä¸‹ä¸€æ­¥å»ºè®®

æ‚¨å¸Œæœ›æˆ‘å…ˆå¸®æ‚¨å®ç°å“ªä¸ªéƒ¨åˆ†ï¼Ÿ

1. **æ•´åˆ yfinance æ•°æ®æº** â†’ åˆ›å»º `manager_yfinance.py`
2. **å°è£… VCP ç­–ç•¥** â†’ ç»§æ‰¿ `StrategyBase` çš„å®Œæ•´å®ç°
3. **ç»Ÿä¸€æ•°æ®æ¥å£** â†’ `DataFactory` å·¥å‚æ¨¡å¼
4. **æ•´ç† x æ–‡ä»¶å¤¹** â†’ å°†æœ‰ä»·å€¼ä»£ç è¿ç§»è‡³ä¸»é¡¹ç›®